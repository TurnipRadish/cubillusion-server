name: Release Resource Packs

on:
  push:
    branches: [ main, master ]
    paths:
      - 'resourcepacks/**'
      - '.github/workflows/release-resourcepacks.yml'

permissions:
  contents: write  # æ·»åŠ è¿™ä¸ªæƒé™å—
  
jobs:
  release:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        fetch-tags: true
    
    - name: Get version info
      id: version
      run: |
        # è·å–ç‰ˆæœ¬ä¿¡æ¯å’Œå˜æ›´è¯¦æƒ…
        TIMESTAMP=$(date -u +"%Y%m%d%H%M%S")
        SHORT_SHA="${GITHUB_SHA:0:7}"
        echo "timestamp=$TIMESTAMP" >> $GITHUB_OUTPUT
        echo "short_sha=$SHORT_SHA" >> $GITHUB_OUTPUT
        
        # è·å–å˜æ›´çš„æ–‡ä»¶åˆ—è¡¨
        echo "å˜æ›´çš„èµ„æºåŒ…æ–‡ä»¶:"
        git diff --name-only HEAD~1 HEAD -- resourcepacks/ || echo "æ— æ³•è·å–å˜æ›´æ–‡ä»¶"
    
    - name: Create Resource Pack Release
      uses: softprops/action-gh-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: resourcepack-${{ steps.version.outputs.timestamp }}-${{ steps.version.outputs.short_sha }}
        name: "èµ„æºåŒ…æ›´æ–° v1.0.${{ github.run_number }}"
        body: |
          ## ğŸ¨ èµ„æºåŒ…è‡ªåŠ¨æ›´æ–°å‘å¸ƒ
          
          ### å‘å¸ƒä¿¡æ¯
          | é¡¹ç›® | è¯¦æƒ… |
          |------|------|
          | **ç‰ˆæœ¬** | v1.0.${{ github.run_number }} |
          | **æäº¤å“ˆå¸Œ** | `${{ steps.version.outputs.short_sha }}` |
          | **è§¦å‘è€…** | @${{ github.actor }} |
          | **å‘å¸ƒæ—¶é—´** | ${{ github.event.head_commit.timestamp }} |
          
          ### å˜æ›´å†…å®¹
          **æäº¤ä¿¡æ¯:**  
          ${{ github.event.head_commit.message }}
          
          **ç›¸å…³æ–‡ä»¶å˜æ›´:**
          ```bash
          git diff --name-only HEAD~1 HEAD -- resourcepacks/
          ```
          
          ### ä¸‹è½½è¯´æ˜
          - ğŸ“¦ èµ„æºåŒ…æ–‡ä»¶ä½äº `resourcepacks/` ç›®å½•
          - ğŸ”„ è‡ªåŠ¨éƒ¨ç½²åˆ°MinecraftæœåŠ¡å™¨
          - ğŸ“‹ [æŸ¥çœ‹å·¥ä½œæµè¿è¡Œè¯¦æƒ…](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})
          
          ---
          *æœ¬Releaseç”±GitHub Actionsè‡ªåŠ¨ç”Ÿæˆ*
        draft: false
        prerelease: false
        generate_release_notes: true
        files: |
          resourcepacks/**
